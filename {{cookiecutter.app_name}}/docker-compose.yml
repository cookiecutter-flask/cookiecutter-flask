version: '3'

volumes:
  {{cookiecutter.repo_name}}-data:
    driver: local

services:
  app:
    build:
      dockerfile: ./docker/app/Dockerfile
    depends_on:
      - postgres
    env_file:
      - ./docker/app/.env
    expose:
      - ${APP_PORT}
    volumes:
      - {{cookiecutter.repo_name}}-data:/data
      - "./docker/app/config:/config"
    command: ["/run.sh"]

  nginx:
    build:
      dockerfile: ./docker/nginx/Dockerfile
    env_file:
      - ./docker/app/.env
    depends_on:
      - app
    environment:
      - NGINX_PORT=${APP_PORT}
    ports:
      - ${APP_PORT}:${APP_PORT}
    volumes:
      - {{cookiecutter.repo_name}}-data:/data
    command: ["/run.sh"]

    postgres:
      build:
        dockerfile: ./docker/postgres/Dockerfile
      volumes:
        - {{cookiecutter.repo_name}}-data:/data
      logging:
        options:
          max-size: "5m"
          max-file: "1"
      env_file: ./docker/postgres/.env
      ports:
          - "5433:5432"
